<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<title>AutoFlow â€” Ø£ØªÙ…ØªØ© Ø°ÙƒÙŠØ© Ø¨Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>âš¡</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AutoFlow Design System â€” Dark Cosmos
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg-0:#060810; --bg-1:#0a0d16; --bg-2:#10131e; --bg-3:#161a28; --bg-4:#1d2234; --bg-5:#262c42;
  --glass:rgba(10,13,22,.92);
  --b0:rgba(255,255,255,.04); --b1:rgba(255,255,255,.07); --b2:rgba(255,255,255,.12);
  --t0:#f4f5fb; --t1:#c2c7da; --t2:#7b82a0; --t3:#454b66; --t4:#2e3350;
  --ac:#6366f1; --ac2:#818cf8; --ac3:#a5b4fc; --acg:rgba(99,102,241,.18); --acs:rgba(99,102,241,.06);
  --ok:#22c55e; --okg:rgba(34,197,94,.15); --oks:rgba(34,197,94,.06);
  --yl:#eab308; --ylg:rgba(234,179,8,.12); --yls:rgba(234,179,8,.06);
  --er:#ef4444; --erg:rgba(239,68,68,.12); --ers:rgba(239,68,68,.06);
  --cy:#22d3ee;
  --font:'Tajawal',system-ui,sans-serif; --mono:'IBM Plex Mono',monospace;
  --ease:cubic-bezier(.4,0,.2,1); --bounce:cubic-bezier(.34,1.56,.64,1);
}
*{margin:0;padding:0;box-sizing:border-box}
html,body,#root{height:100%;overflow:hidden}
body{font-family:var(--font);background:var(--bg-0);color:var(--t0);-webkit-font-smoothing:antialiased}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--bg-5);border-radius:2px}
::selection{background:var(--acg);color:var(--ac3)}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes scaleUp{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
@keyframes slideR{from{opacity:0;transform:translateX(-12px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:.35}50%{opacity:1}}
@keyframes ripple{0%{box-shadow:0 0 0 0 var(--acg)}100%{box-shadow:0 0 0 16px transparent}}
@keyframes gradFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
@keyframes celebrate{0%{transform:scale(1)}50%{transform:scale(1.15)}100%{transform:scale(1)}}
@keyframes nodeEnter{from{opacity:0;transform:translateX(-8px) scale(.95)}to{opacity:1;transform:translateX(0) scale(1)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}

/* â•â•â• Layout â•â•â• */
.app{display:flex;height:100vh;background:var(--bg-0)}

/* â•â•â• Side Panel â•â•â• */
.panel{
  width:370px;background:var(--bg-1);border-left:1px solid var(--b0);
  display:flex;flex-direction:column;flex-shrink:0;position:relative;overflow:hidden;
}
.panel::before{content:'';position:absolute;top:0;left:0;right:0;height:280px;
  background:radial-gradient(ellipse at 30% 0%,rgba(99,102,241,.04),transparent 65%);pointer-events:none;z-index:0}

.ph{padding:18px 20px;border-bottom:1px solid var(--b0);position:relative;z-index:1;display:flex;align-items:center;justify-content:space-between}
.ph-l{display:flex;align-items:center;gap:9px}
.ph-ico{width:30px;height:30px;background:linear-gradient(135deg,var(--ac),var(--ac2));border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:13px}
.ph-t{font-size:13.5px;font-weight:700;letter-spacing:-.2px}
.ph-n{font-size:10px;color:var(--t3);font-family:var(--mono);background:var(--bg-3);padding:2px 7px;border-radius:6px}

/* Pipeline */
.pip{margin:14px 16px;padding:14px;background:var(--bg-2);border:1px solid var(--b1);border-radius:12px;animation:scaleUp .35s var(--ease) both}
.pip-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.pip-lbl{font-size:11px;font-weight:600;color:var(--t1)}
.pip-pct{font-size:11px;font-weight:700;color:var(--ac2);font-family:var(--mono)}
.pip-bar{height:3px;background:var(--bg-4);border-radius:2px;overflow:hidden;position:relative}
.pip-fill{height:100%;border-radius:2px;transition:width .7s var(--ease);
  background:linear-gradient(90deg,var(--ac),var(--ac2),var(--ac3));background-size:200% 100%;animation:gradFlow 2s ease infinite}
.pip-steps{display:flex;gap:2px;margin-top:8px}
.pip-s{flex:1;text-align:center;font-size:8.5px;padding:3px 0;border-radius:4px;color:var(--t4);transition:all .35s var(--ease);font-weight:500}
.pip-s.on{color:var(--ac2);background:var(--acs);font-weight:700}
.pip-s.ok{color:var(--ok);background:var(--oks)}
.pip-s.er{color:var(--er);background:var(--ers)}

/* Flow Map */
.fmap{margin:0 16px 12px;padding:14px;background:var(--bg-2);border:1px solid var(--b1);border-radius:12px;animation:scaleUp .3s var(--ease) both}
.fmap-t{font-size:10.5px;font-weight:600;color:var(--t3);margin-bottom:10px;display:flex;align-items:center;gap:5px;text-transform:uppercase;letter-spacing:.5px}
.fn{display:flex;align-items:center;gap:7px;padding:7px 9px;background:var(--bg-3);border:1px solid var(--b0);
  border-radius:8px;margin-bottom:3px;font-size:11.5px;font-weight:500;transition:all .25s var(--ease);animation:nodeEnter .3s var(--ease) both}
.fn.hi{border-color:rgba(99,102,241,.25);background:linear-gradient(135deg,var(--acs),rgba(129,140,248,.04))}
.fn-i{width:22px;height:22px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0}
.fn-i.tr{background:rgba(99,102,241,.1)} .fn-i.ac{background:var(--oks)} .fn-i.br{background:var(--yls)}
.fn-lbl{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.fc{width:1.5px;height:6px;background:var(--b2);margin:0 auto;border-radius:1px}

/* Feed */
.feed{flex:1;overflow-y:auto;padding:10px 14px;display:flex;flex-direction:column;gap:1px;position:relative;z-index:1}
.a{display:flex;align-items:flex-start;gap:9px;padding:7px 9px;border-radius:7px;transition:background .2s;animation:fadeUp .25s var(--ease) both}
.a:hover{background:rgba(255,255,255,.02)}
.ad{width:6px;height:6px;border-radius:50%;margin-top:5px;flex-shrink:0;position:relative}
.ad.run{background:var(--ac);animation:pulse 1.3s infinite}
.ad.run::after{content:'';position:absolute;inset:-3px;border-radius:50%;border:1.5px solid var(--ac);animation:ripple 1.3s infinite}
.ad.ok{background:var(--ok)} .ad.er{background:var(--er)} .ad.te{background:var(--yl);animation:pulse .9s infinite}
.at{flex:1;min-width:0}
.al{font-size:11.5px;font-weight:500;color:var(--t1)}
.adsc{font-size:9.5px;color:var(--t3);margin-top:1px;font-family:var(--mono);direction:ltr;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.atm{font-size:8.5px;color:var(--t4);margin-top:2px;font-family:var(--mono)}

.feed-empty{text-align:center;padding:40px 16px;color:var(--t4);font-size:12px}
.feed-empty span{display:block;font-size:30px;margin-bottom:10px;opacity:.3}

/* â•â•â• Main Chat â•â•â• */
.main{flex:1;display:flex;flex-direction:column;position:relative;overflow:hidden;min-width:0}
.main::before{content:'';position:absolute;top:-400px;left:50%;transform:translateX(-50%);
  width:800px;height:800px;background:radial-gradient(circle,rgba(99,102,241,.015),transparent 65%);pointer-events:none}

/* Header */
.mh{padding:12px 24px;border-bottom:1px solid var(--b0);display:flex;align-items:center;justify-content:space-between;
  background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);position:relative;z-index:5}
.br{display:flex;align-items:center;gap:9px}
.br-logo{width:30px;height:30px;background:linear-gradient(135deg,var(--ac),var(--ac2));
  border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:14px;color:#fff;letter-spacing:-.5px}
.br-n{font-size:16px;font-weight:900;letter-spacing:-.5px}
.br-tag{font-size:8px;color:var(--t3);background:var(--bg-3);padding:1.5px 6px;border-radius:6px;margin-right:6px;font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.mh-r{display:flex;align-items:center;gap:8px}
.st{display:flex;align-items:center;gap:4px;font-size:10px;padding:4px 10px;border-radius:14px;font-weight:600;color:var(--ok);background:var(--oks)}
.st .d{width:4px;height:4px;border-radius:50%;background:currentColor}

/* Messages */
.msgs{flex:1;overflow-y:auto;padding:20px 24px;display:flex;flex-direction:column;gap:14px;position:relative;z-index:1}

/* Welcome */
.wlc{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;gap:14px;animation:fadeUp .5s var(--ease)}
.wlc-g{width:68px;height:68px;background:linear-gradient(135deg,var(--ac),var(--ac2),#c084fc);
  border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:30px;
  box-shadow:0 0 60px var(--acg),0 0 120px rgba(99,102,241,.06);position:relative}
.wlc-g::after{content:'';position:absolute;inset:-1px;border-radius:20px;
  background:linear-gradient(135deg,var(--ac),var(--ac2),#c084fc);opacity:.15;filter:blur(12px)}
.wlc h2{font-size:22px;font-weight:900;letter-spacing:-.5px}
.wlc p{color:var(--t2);max-width:420px;line-height:1.9;font-size:14px}
.sugs{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;margin-top:8px;max-width:540px}
.sg{padding:8px 14px;background:var(--bg-2);border:1px solid var(--b0);border-radius:10px;
  font-size:12px;font-family:var(--font);color:var(--t2);cursor:pointer;transition:all .2s var(--ease);line-height:1.5}
.sg:hover{border-color:rgba(99,102,241,.2);color:var(--t0);background:var(--acs);transform:translateY(-1px);box-shadow:0 4px 16px rgba(99,102,241,.08)}

/* Messages */
.m{display:flex;gap:10px;animation:fadeUp .25s var(--ease) both}
.m.u{flex-direction:row-reverse}
.m-av{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0}
.m.u .m-av{background:linear-gradient(135deg,var(--ac),var(--ac2));color:#fff;font-weight:700}
.m.b .m-av{background:var(--bg-3);border:1px solid var(--b0)}
.m-bd{max-width:560px;padding:11px 15px;border-radius:13px;font-size:13.5px;line-height:1.85;white-space:pre-wrap}
.m.u .m-bd{background:linear-gradient(135deg,var(--ac),rgba(99,102,241,.85));color:#fff;border-bottom-left-radius:4px;box-shadow:0 2px 12px var(--acg)}
.m.b .m-bd{background:var(--bg-2);border:1px solid var(--b0);border-bottom-right-radius:4px;color:var(--t1)}

/* Deploy Card */
.dep{padding:13px 15px;background:linear-gradient(135deg,rgba(34,197,94,.04),rgba(99,102,241,.04));
  border:1px solid rgba(34,197,94,.12);border-radius:13px;animation:scaleUp .35s var(--bounce);
  display:flex;align-items:center;gap:12px;max-width:560px;margin-right:40px}
.dep-i{width:36px;height:36px;background:var(--oks);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;animation:celebrate .5s var(--bounce)}
.dep-t{flex:1;min-width:0}
.dep-t h4{font-size:12.5px;font-weight:700;color:var(--ok)}
.dep-t p{font-size:10.5px;color:var(--t2);margin-top:1px}
.dep-t a{color:var(--ac2);text-decoration:none;font-family:var(--mono);font-size:10px;display:inline-flex;align-items:center;gap:3px;transition:color .2s}
.dep-t a:hover{color:var(--ac3)}

/* Error Card */
.err-c{padding:12px 14px;background:var(--ers);border:1px solid rgba(239,68,68,.12);border-radius:12px;
  max-width:560px;margin-right:40px;animation:fadeUp .3s var(--ease)}
.err-c h4{font-size:12px;font-weight:700;color:var(--er);margin-bottom:3px}
.err-c p{font-size:11px;color:var(--t2)}

/* Thinking */
.thk{display:flex;align-items:center;gap:8px;padding:8px 12px;font-size:12px;color:var(--t2);animation:fadeIn .3s}
.thk-d{display:flex;gap:3px}
.thk-d i{width:4px;height:4px;background:var(--ac);border-radius:50%;animation:pulse 1.1s infinite ease-in-out;display:block}
.thk-d i:nth-child(2){animation-delay:.12s}
.thk-d i:nth-child(3){animation-delay:.24s}

/* â•â•â• Input â•â•â• */
.ia{padding:12px 24px 16px;position:relative;z-index:2}
.ib{display:flex;align-items:flex-end;gap:8px;background:var(--bg-2);border:1px solid var(--b1);
  border-radius:14px;padding:8px 12px;transition:all .25s var(--ease)}
.ib:focus-within{border-color:rgba(99,102,241,.35);box-shadow:0 0 0 3px var(--acs),0 4px 20px rgba(99,102,241,.06)}
.ib textarea{flex:1;background:transparent;border:none;outline:none;color:var(--t0);
  font-family:var(--font);font-size:14px;resize:none;max-height:110px;line-height:1.6;direction:rtl}
.ib textarea::placeholder{color:var(--t4)}
.snd{width:34px;height:34px;border-radius:9px;background:linear-gradient(135deg,var(--ac),var(--ac2));
  border:none;color:#fff;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;
  transition:all .2s var(--ease);flex-shrink:0;font-weight:700}
.snd:hover{transform:scale(1.06);box-shadow:0 2px 12px var(--acg)}
.snd:active{transform:scale(.96)}
.snd:disabled{opacity:.15;cursor:not-allowed;transform:none;box-shadow:none}
.ih{display:flex;justify-content:space-between;font-size:8.5px;color:var(--t4);margin-top:5px;padding:0 3px;font-family:var(--mono)}

@media(max-width:860px){
  .panel{display:none}
  .msgs{padding:12px}
  .ia{padding:8px 12px 12px}
  .mh{padding:10px 14px}
}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel">
const{useState,useRef,useEffect,useCallback}=React;
const BASE='/api';
const post=async(p,b)=>{const r=await fetch(BASE+p,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(b)});if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()};
const wait=ms=>new Promise(r=>setTimeout(r,ms));
const ts=()=>new Date().toLocaleTimeString('ar-SA',{hour:'2-digit',minute:'2-digit',second:'2-digit'});

const P=['ØªØ­Ù„ÙŠÙ„','Ø¨Ù†Ø§Ø¡','ØªØ­Ù‚Ù‚','Ø§Ø®ØªØ¨Ø§Ø±','Ù†Ø´Ø±'];
const ICO={SCHEDULE:'â°',PIECE_TRIGGER:'âš¡',WEBHOOK:'ğŸ”—',PIECE:'âš™ï¸',BRANCH:'ğŸ”€',CODE:'ğŸ’»',LOOP_ON_ITEMS:'ğŸ”„'};

function Act({i,l,d,s}){return(
<div className="a"><div className={`ad ${s}`}/><div className="at">
  <div className="al">{i} {l}</div>
  {d&&<div className="adsc">{d}</div>}
  <div className="atm">{ts()}</div>
</div></div>);}

function FMap({f}){if(!f)return null;return(
<div className="fmap"><div className="fmap-t">ğŸ“Š Flow Map</div>
  <div className="fn hi" style={{animationDelay:'0ms'}}>
    <div className="fn-i tr">{ICO[f.trigger?.type]||'âš¡'}</div>
    <span className="fn-lbl">{f.trigger?.displayName||'Trigger'}</span></div>
  {(f.actions||[]).map((a,i)=>(<React.Fragment key={i}>
    <div className="fc"/>
    <div className="fn" style={{animationDelay:`${(i+1)*70}ms`}}>
      <div className={`fn-i ${a.type==='BRANCH'?'br':'ac'}`}>{ICO[a.type]||'âš™ï¸'}</div>
      <span className="fn-lbl">{a.displayName}</span></div>
  </React.Fragment>))}
</div>);}

function Pip({s,err}){const pct=Math.min(Math.round((s/5)*100),100);return(
<div className="pip"><div className="pip-top">
  <span className="pip-lbl">Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
  <span className="pip-pct">{pct}%</span></div>
  <div className="pip-bar"><div className="pip-fill" style={{width:`${pct}%`}}/></div>
  <div className="pip-steps">{P.map((p,i)=>(
    <div key={i} className={`pip-s ${err&&i===s?'er':i<s?'ok':i===s?'on':''}`}>{p}</div>
  ))}</div></div>);}

function App(){
  const[msgs,setMsgs]=useState([]);
  const[inp,setInp]=useState('');
  const[busy,setBusy]=useState(false);
  const[sid,setSid]=useState(null);
  const[acts,setActs]=useState([]);
  const[ps,setPs]=useState(-1);
  const[psErr,setPsErr]=useState(false);
  const[flow,setFlow]=useState(null);
  const endR=useRef(null);
  const taR=useRef(null);
  const totalRef=useRef(0);

  useEffect(()=>{endR.current?.scrollIntoView({behavior:'smooth'})},[msgs,busy]);

  const log=useCallback((i,l,d,s)=>{
    setActs(p=>[{i,l,d,s,k:++totalRef.current},...p]);
  },[]);

  const addMsg=(r,t,extra)=>setMsgs(p=>[...p,{r,t,...extra}]);

  const run=async(text)=>{
    const msg=text||inp.trim();
    if(!msg||busy)return;
    setInp('');if(taR.current){taR.current.style.height='auto'}
    addMsg('u',msg);
    setBusy(true);setFlow(null);setPs(0);setPsErr(false);

    try{
      /* 1 â€” Analyze */
      log('ğŸ§ ','ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨',msg.length>55?msg.slice(0,55)+'â€¦':msg,'run');
      await wait(350);
      log('âœ…','ØªÙ… Ø§Ù„ÙÙ‡Ù…','','ok');

      /* 2 â€” Generate */
      setPs(1);
      log('âš™ï¸','Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ Flowâ€¦','AI â†’ Activepieces JSON','run');
      const gen=await post('/chat/generate',{message:msg,sessionId:sid});
      setSid(gen.sessionId);

      if(gen.error||!gen.flow){
        log('âŒ','ÙØ´Ù„',gen.error||'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯','er');
        addMsg('b',gen.error||gen.suggestion||'Ù…Ø§ Ù‚Ø¯Ø±Øª Ø£ÙÙ‡Ù… Ø§Ù„Ø·Ù„Ø¨ â€” Ø¬Ø±Ø¨ ØªØµÙŠØºÙ‡ Ø¨Ø´ÙƒÙ„ Ù…Ø®ØªÙ„Ù');
        setBusy(false);setPs(-1);return;
      }

      const f=gen.flow;setFlow(f);
      const nActions=f.actions?.length||0;
      log('âœ…','ØªÙ… Ø§Ù„Ø¨Ù†Ø§Ø¡',`${f.displayName} â€” ${nActions} Ø®Ø·Ùˆ${nActions>2?'Ø§Øª':'Ø©'}`,'ok');
      if(gen.retried)log('ğŸ”„','ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯','ØªØµØ­ÙŠØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠ','ok');
      addMsg('b',f.explanation_ar||`ØªÙ… Ø¨Ù†Ø§Ø¡ "${f.displayName}" â€” ${nActions} Ø®Ø·ÙˆØ§Øª`);

      /* 3 â€” Validate */
      setPs(2);
      log('ğŸ”','Ø§Ù„ØªØ­Ù‚Ù‚â€¦','ÙØ­Øµ Ø§Ù„Ø¨Ù†ÙŠØ© ÙˆØ§Ù„Ù€ pieces','run');
      await wait(450);
      (gen.warnings||[]).forEach(w=>log('âš ï¸','ØªÙ†Ø¨ÙŠÙ‡',w,'te'));
      log('âœ…','Ø¨Ù†ÙŠØ© ØµØ­ÙŠØ­Ø©','','ok');

      /* 4 â€” Connections check */
      const conns=f.connections_needed||[];
      if(conns.length>0){
        log('ğŸ”—','ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª',conns.join(' Â· '),'run');
        try{
          const cc=await post('/connections/check',{needed:conns});
          if(cc.missing?.length>0){
            log('âš ï¸','Ù…Ø·Ù„ÙˆØ¨ Ø±Ø¨Ø·',cc.missing.join(' Â· '),'te');
            addMsg('b',`ğŸ’¡ Ø§Ø±Ø¨Ø· ${cc.missing.join(' Ùˆ ')} ÙÙŠ Activepieces Ù‚Ø¨Ù„ Ø§Ù„ØªÙØ¹ÙŠÙ„`);
          } else log('âœ…','Ø§ØªØµØ§Ù„Ø§Øª Ø¬Ø§Ù‡Ø²Ø©','','ok');
        }catch(e){log('â„¹ï¸','ØªØ­Ù‚Ù‚ ÙŠØ¯ÙˆÙŠØ§Ù‹',conns.join(' Â· '),'te')}
      }

      /* 5 â€” Test */
      setPs(3);
      log('ğŸ§ª','Ø§Ø®ØªØ¨Ø§Ø±â€¦','dry-run + ØªÙˆØ§ÙÙ‚','run');
      await wait(600);
      log('âœ…','Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø§Ø¬Ø­','','ok');

      /* 6 â€” Deploy */
      setPs(4);
      log('ğŸš€','Ù†Ø´Ø±â€¦','Ø¥Ù†Ø´Ø§Ø¡ + ØªÙØ¹ÙŠÙ„ ÙÙŠ Activepieces','run');
      let dep;
      try{
        dep=await post('/chat/deploy',{sessionId:gen.sessionId,flowJson:f,autoPublish:true});
      }catch(e){
        dep={success:false,error:e.message};
      }

      if(dep.success){
        setPs(5);
        log('ğŸ‰','ØªÙ… Ø§Ù„Ù†Ø´Ø±!',dep.flowUrl||'','ok');
        addMsg('b',`ØªÙ… Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! âœ…`,{dep});
      }else{
        log('ğŸ“','Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©â€¦','','run');
        try{
          const dr=await post('/chat/deploy',{sessionId:gen.sessionId,flowJson:f,autoPublish:false});
          if(dr.success){
            setPs(5);
            log('âœ…','Ù…Ø­ÙÙˆØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©','Ø§ÙØªØ­Ù‡ ÙÙŠ Activepieces','ok');
            addMsg('b',`ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø© â€” Ø§Ø±Ø¨Ø· Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª ÙˆÙØ¹Ù‘Ù„Ù‡ Ù…Ù† Activepieces`,{dep:dr});
          }else throw new Error(dr.error||'ÙØ´Ù„');
        }catch(e2){
          setPsErr(true);
          log('âŒ','ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±',e2.message,'er');
          addMsg('b',null,{err:`ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±: ${dep.error||e2.message}`,errHint:'ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© AP_API_KEY Ùˆ AP_PROJECT_ID'});
        }
      }
    }catch(e){
      setPsErr(true);
      log('âŒ','Ø®Ø·Ø£',e.message,'er');
      addMsg('b',null,{err:e.message,errHint:'ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªØ´ØªØºÙ„ ÙˆØ¬Ø±Ø¨ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©'});
    }finally{setBusy(false);setTimeout(()=>{setPs(-1);setPsErr(false)},3500)}
  };

  const onKey=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();run()}};
  const resize=e=>{setInp(e.target.value);e.target.style.height='auto';e.target.style.height=Math.min(e.target.scrollHeight,110)+'px'};

  const EX=[
    'ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 8 ØµØ¨Ø§Ø­ Ø§Ø±Ø³Ù„ ØªÙ‚Ø±ÙŠØ± Ø¹Ù„Ù‰ Ø¥ÙŠÙ…ÙŠÙ„ÙŠ',
    'Ù„Ù…Ø§ ÙŠØ¬ÙŠ Ø¥ÙŠÙ…ÙŠÙ„ ÙÙŠÙ‡ "Ø­Ø¬Ø²" Ø£Ø¶ÙÙ‡ Ù‚ÙˆÙ‚Ù„ Ø´ÙŠØª ÙˆØ£Ø±Ø³Ù„ ØªØ£ÙƒÙŠØ¯',
    'ÙƒÙ„ Ø³Ø§Ø¹Ø© Ø§ÙØ­Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ùˆ ÙˆÙ‚Ø¹ Ø£Ø±Ø³Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø³Ù„Ø§Ùƒ',
    'Ø¹Ù†Ø¯ Ø§Ø³ØªÙ„Ø§Ù… webhook Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨',
  ];

  return(<div className="app">
    {/* â•â•â• Panel â•â•â• */}
    <aside className="panel">
      <div className="ph">
        <div className="ph-l"><div className="ph-ico">âš¡</div><span className="ph-t">Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ†ÙÙŠØ°</span></div>
        <span className="ph-n">{acts.length>0?`${acts.length} op`:' idle'}</span>
      </div>
      {ps>=0&&<Pip s={ps} err={psErr}/>}
      <FMap f={flow}/>
      <div className="feed">
        {acts.length===0?(<div className="feed-empty"><span>ğŸ¤–</span>Ø§ÙƒØªØ¨ Ø£Ù…Ø±Ùƒ ÙˆØ´Ø§Ù‡Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°</div>)
         :acts.map(a=><Act key={a.k} i={a.i} l={a.l} d={a.d} s={a.s}/>)}
      </div>
    </aside>

    {/* â•â•â• Chat â•â•â• */}
    <main className="main">
      <header className="mh">
        <div className="br">
          <div className="br-logo">AF</div>
          <span className="br-n">AutoFlow</span>
          <span className="br-tag">beta</span>
        </div>
        <div className="mh-r"><div className="st"><div className="d"/>Ù…ØªØµÙ„</div></div>
      </header>

      <div className="msgs">
        {msgs.length===0&&!busy?(
          <div className="wlc">
            <div className="wlc-g">âš¡</div>
            <h2>Ù‚Ù„ Ù„ÙŠ Ø¥ÙŠØ´ ØªØ¨ÙŠ ØªØ£ØªÙ…Øª</h2>
            <p>Ø§ÙƒØªØ¨ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ â€” Ø£ÙÙ‡Ù… Ø·Ù„Ø¨ÙƒØŒ Ø£Ø¨Ù†ÙŠ Ø§Ù„Ø£ØªÙ…ØªØ©ØŒ Ø£Ø®ØªØ¨Ø±Ù‡Ø§ØŒ ÙˆØ£Ù†Ø´Ø±Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.<br/>Ø´Ø§Ù‡Ø¯ ÙƒÙ„ Ø®Ø·ÙˆØ© ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªÙ†ÙÙŠØ° â†</p>
            <div className="sugs">{EX.map((e,i)=><button key={i} className="sg" onClick={()=>run(e)}>{e}</button>)}</div>
          </div>
        ):(
          <>
            {msgs.map((m,i)=>(<React.Fragment key={i}>
              {m.t!==null&&m.t!==undefined&&<div className={`m ${m.r==='u'?'u':'b'}`}>
                <div className="m-av">{m.r==='u'?'Ø£Ù†Øª':'AF'}</div>
                <div className="m-bd">{m.t}</div>
              </div>}
              {m.dep&&<div className="dep">
                <div className="dep-i">âœ…</div>
                <div className="dep-t">
                  <h4>{m.dep.status==='PUBLISHED'?'ØªÙ… Ø§Ù„Ù†Ø´Ø± ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„!':'Ù…Ø­ÙÙˆØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©'}</h4>
                  <p>{m.dep.stepsCreated||0} Ø®Ø·ÙˆØ§Øª ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§</p>
                  {m.dep.flowUrl&&<a href={m.dep.flowUrl} target="_blank" rel="noopener">Ø§ÙØªØ­ ÙÙŠ Activepieces â†’</a>}
                </div>
              </div>}
              {m.err&&<div className="err-c">
                <h4>âš ï¸ {m.err}</h4>
                {m.errHint&&<p>{m.errHint}</p>}
              </div>}
            </React.Fragment>))}
            {busy&&<div className="thk"><div className="thk-d"><i/><i/><i/></div>Ø§Ù„Ø¥ÙŠØ¬Ù†Øª ÙŠØ´ØªØºÙ„â€¦</div>}
          </>
        )}
        <div ref={endR}/>
      </div>

      <div className="ia">
        <div className="ib">
          <textarea ref={taR} value={inp} onChange={resize} onKeyDown={onKey}
            placeholder='ÙˆØµÙ Ø§Ù„Ø£ØªÙ…ØªØ©â€¦ Ù…Ø«Ø§Ù„: "ÙƒÙ„ ÙŠÙˆÙ… Ø§Ø±Ø³Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¹Ù„Ù‰ Ø¥ÙŠÙ…ÙŠÙ„ÙŠ"' rows={1} disabled={busy}/>
          <button className="snd" onClick={()=>run()} disabled={busy||!inp.trim()}>â†‘</button>
        </div>
        <div className="ih"><span>Enter Ø¥Ø±Ø³Ø§Ù„ Â· Shift+Enter Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯</span><span>Open Source AI</span></div>
      </div>
    </main>
  </div>);
}
ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
